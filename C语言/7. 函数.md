# 7. 函数

## 7.1 函数的声明与定义-嵌套调用

### 7.1.1 函数的声明与定义

函数间的调用关系是，由主函数（main函数）调用其他函数，其他函数也可以互相调用，但是其他函数不可以调用main函数。同一个函数可以被一个或多个函数调用任意次。

~~~c
#include <stdio.h>  
void print_message();//声明函数  
int main()  //主函数
{  
    print_message();//调用函数  
    return 0;  
}  
void print_message()//定义函数  
{  
    printf("How do you do\n");  
}
~~~

* 声明函数
* 调用函数（在main函数或者其他函数中）
* 定义函数

~~~c
//func.h

#ifndef FUNC_H  
#define FUNC_H  
//放在这里避免重复编写  
#include <stdio.h>  
//函数声明，可以调换顺序  
void print_message();  
int print_star(int i);  

#endif //FUNC_H
~~~

~~~c
//main.c

#include "func.h"  
//函数的声明写到了func.h文件中，头文件也写到了func.h文件中 
int main()  
{  
    int a = 10;  
    a = print_star(a);//调用函数，接收返回值  
    print_message();//调用函数  
    print_star(5);  
    return 0;  
}  
//函数的定义放到了func.c文件中
~~~

~~~c
//func.c

#include "func.h"  
int print_star(int i)  
{  
    printf("---------------\n");  
    printf("print_star %d\n",i);  
    return i+3;  
}  
void  print_message()//可以嵌套调用上面的函数  
{  
    printf("How do you do\n");  
    print_star(6);//这里的返回值可以选择接收或者不接收  
}
~~~

1. 一个C程序由一个或多个程序模块组成，每个程序模块作为一个源程序文件。对于较大的程序，通常将程序内容分别放在若干源文件中，再由若干源程序文件组成一个C程序。这样处理便于**分别编写、分别编译，进而提高调试效率(复试有用)**。一个源程序文件可以为多个C 程序共用。
2. 一个源程序文件由一个或多个函数及其他有关内容(如命令行、数据定义等)组成。一个源程序文件是一个编译单位,在程序编译时是以源程序文件为单位而不是以函数为单位进行编译的。main.c和 func.c分别单独编译，在链接成为可执行文件时，main 中调用的函数print_star 和print_ message 才会通过链接去找到函数定义的位置。
3. C程序的执行是从 main 函数开始的，如果在 main 函数中调用其他函数，那么在调用后会返回到 main 函数中，在 main 函数中结束整个程序的运行。
4. 所有函数都是平行的，即在定义函数时是分别进行的，并且是互相独立的。一个函数并不从属于另一函数,即函数不能嵌套定义。函数间可以互相调用，但不能调用 main 函数。

函数的定义和声明的区别：

* 函数的定义是指对函数功能的确立，包括指定函数名、函数值类型、形参及其类型、函数体等，它是一个完整的、独立的函数单位。
* 函数的声明的作用是把函数的名字、函数类型及形参的类型、个数和顺序通知编译系统，以便在调用该函数时编译系统能正确识别函数并检查调用是否合法。

**不要使用隐式声明**，C语言中有几种声明的类型名可以省略，称之为隐式声明

### 7.1.2 函数的分类与调用

* 标准函数：即库函数，这是由系统提供的，用户不必自己定义的函数，可以直接使用，如 printf 函数、scanf 函数。不同的C系统提供的库函数的数量和功能会有一些不同，但许多基本的函数是相同的。
* 用户自己定义的函数：用以解决用户的专门需要

* 无参函数:一般用来执行指定的一组操作。在调用无参函数时，主调函数不向被调用函数传递数据。
* 有参函数：主调函数在调用被调用函数时，通过参数向被调用函数传递数据。


## 7.2 函数的递归调用

* 函数调用自身的操作称之为递归
* 递归函数一定要有结束条件（写在return之前），否则会产生死循环。
* 递归的核心就是**找公式**

~~~c
//求函数的阶乘
#include <stdio.h>  
int f(int n)  
{  
    if (n == 1) //设置结束条件
    {  
        return ;  
    }  
    return n*f(n-1);//找到的公式f(n)=f(n)*f(n-1)
}  
int main()  
{  
    int i ;  
    scanf("%d",&i);  
    printf("%d",f(i));  
    return 0;
}
~~~




## 7.3 局部变量与全局变量

### 7.3.1 全局变量-形参-实参

不同函数之间传递数据时：

* 参数：通过形式参数和实际参数
* 返回值：用return语句返回结果（只能返回一个）
* 全局变量：外部变量

~~~c
//全局变量演示（尽量不要使用）
#include <stdio.h>  
int i = 10;//i是一个全局变量  
void print(int a)  
{  
    printf("print i=%d\n", i);  //访问的全局变量i
}  
int main()  
{  
    printf("main i=%d\n", i);  //访问的全局变量i
    i = 5;  //修改全局变量i的值
    int i = 10;//创建了一个局部变量i
    print(5);  
    return 0;  
}
//输出
//main i=10
//print i=5 输出的是数据段中的全局变量i
~~~

* 在这里的全局变量i既不存在于栈空间，也不存在于堆空间，它存在于数据段
* 如果局部变量与全局变量重名，那么将采取**就近原则**
* 尽量不要使用全局变量

形式参数与实际参数

1. 定义函数中指定的形参，如果没有函数调用，那么它们并不占用内存中的存储单元。只有在发生函数调用时，函数 print 中的形参才被分配内存单元。在调用结束后，形参所占的内存单元也会被释放。
2. 实参可以是常量、变量或表达式，但要求它们有确定的值，例如，print(i+3)在调用时将实参的值 i+3 赋给形参；print 函数可以有两个形参，如print(int a,int b)
3. 在被定义的函数中，必须指定形参的类型。如果实参列表中包含多个实参，那么各参数间用逗号隔开。**实参与形参的个数应相等**，类型应匹配，且实参与形参应按顺序对应，一一传递数据。
4. 实参与形参的类型应相同或赋值应兼容。
5. 实参向形参的数据传递是单向“值传递”，只能由实参传给形参，而不能由形参传回给实参。在调用函数时，给形参分配存储单元，并将实参对应的值传递给形参，调用结束后，形参单元被释放，实参单元仍保留并维持原值。
6. 形参相当于局部变量，因此不能再定义局部变量与形参同名，否则会造成编译不通。

### 7.3.2 局部变量与全局变量

内部变量（局部变量）

1. 主函数中定义的变量只在主函数中有效，而不因为在主函数中定义而在整个文件或程序中有效。主函数也不能使用其他函数中定义的变量。
2. 不同函数中可以使用相同名字的变量，它们代表不同的对象，互不干扰。
3. 形式参数也是局部变量。
4. 在一个函数内部，可以在复合语句中定义变量，这些变量只在本复合语句中有效，这种复合语句也称“分程序”或“程序块”。
5. 注意一个细节，for 循环的小括号内定义的int，在离开 for 循环后，是不可以再次使用。

外部变量（全程变量，全局变量）

1. 全局变量在程序的全部执行过程中都占用存储单元，而不是仅在需要时才开辟单元。
2. 使用全局变量过多会降低程序的清晰性，在各个函数执行时都可能改变外部变量的值,程序容易出错(初试时尽量不用)。
3. 因为函数在执行时依赖于其所在的外部变量，如果将一个函数移到另一个文件中，那么还要将有关的外部变量及其值一起移过去。然而，如果该外部变量与其他文件的变量同名，那么就会出现问题，即会降低程序的可靠性和通用性。**C语言一般要求把程序中的函数做成一个封闭体，除可以通过“实参一形参”的渠道与外界发生联系外，没有其他渠道**。